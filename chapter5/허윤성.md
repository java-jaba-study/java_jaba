# 스트림 활용

## flatMap
  - 스트림에서 내부 스트림을 하나의 스트림으로 합쳐 준다. (차원감소)
  - Strem<Stream\<T>> -> Stream\<T>
  - 예시  
    {1,2,3}의 요소와 {3,4}의 요소를 각각 매칭시커 {(1,3),(1,4),(2,3),(2,4),(3,3),(3,4)}를 만들기
    
    ```java
    List<Integer> numbers1 = Arrays.asList(1, 2, 3);
    List<Integer> numbers2 = Arrays.asList(3, 4);
    List<int[]> pairs = numbers1.stream()
                                .flatMap(i -> numbers2.stream()
                                                      .map(j -> new int[]{i, j}))
                                .collect(toList());
    ```
    map을 사용한 경우  
    ```[[[1,3],[1,4]],[[2,3],[2,4]],[3,3],[3,4]]]  List<List<int[]>>```
    
    flatMap을 사용한 경우  
    ```[[1,3],[1,4],[2,3],[2,4],[3,3],[3,4]]  List<int[]>```
    
## reduce
  - 스트림 전체의 값을 이용한 연산
  - 각 스트림의 값을 순차적으로 연산(슬라이딩 윈도우 처럼)
  - 사용법
    ```java
    .reduce('초기값', '람다식') // 람다식은 2개의 인자를 받는다

    //모든 리스트를 곱하는 reduce
    .reduce(1, (a, b) -> a*b)
    ```
    a = 이전까지 결과 값(처음엔 초기값)  
    b = 스트림에서 나온 값
      
  **장점**  
  - 병렬화
    - 전체 리스트의 합을 구하는 경우 외부반복의 경우 이전까지의 합 변수를 공유해야 하기 때문에 병렬화가 어려움
    - 내부 반복의 경우 리스트를 분할하여 계산하고 결과를 다시 합치는 방식으로 병렬화 가능
    - *주의할 점 : 병렬화가 가능한 연산만 가능  
      -> 연산의 순서가 상관 없는 경우 (덧셈은 가능 뺄셈은 불가능)
### Optional
  - 초기값이 없는 reduce 가 반환하는 객체 ex. 최댓값을 찾는 reduce
  - 초가값이 없는 경우 반환값이 없는 경우가 있을 수 있기 때문에 결과가 없음을 표현하는 객체  
    ```java
    Optional<Integer> max_int = nums.stream().reduce(Integer::max) 
    ```
## 기본형 특화 스트림
  - 숫자를 다루는 기본형 특화 스트림 (IntStream, DoubleStream, LongStream)

    - 기본 스트림을 특화 스트림으로 변환
        ```java
        .mapToInt(람다식) // IntStream  
        .mapToDuoble(람다식) // DoubleStream  
        .mapToLong(람다식) // LongStream  
        ```  
    - 특화 스트림을 기본 스트림으로 변환  
        ```java
        .boxed()
        ```
  - sum, max 등 숫자 연산을 하는 reduce 연산 수행 method 제공
    ```java
    .reduce(0,Integer::sum) = .sum()
    ```
  - 연속된 숫자 스트림 생성(range, rangeClosed)
    ```java
    IntStream.rangeClosed(1,100) // 1,2,3,4,...,100
    ```
## 스트림 만들기
  - 컬랙션
    ```java
    collection.stream()
    ```
  - 값 입력
    ```java
    Stream.of("a","b","c")
    ```
  - null이 될 수 있는 객체 (빈 스트림)
    ```java
    Stream.ofNullable("객체")
    ```
  - 배열
    ```java
    int[] nums = {1,2,3,4};
    Arrays.stream(nums)
    ```
  - 파일
    ```java
    File.lines(Path.get("filePath"), Charset.defaultCharset())
    ```
### iterate, generate
  - 함수를 이용해 스트림 만들기 (무한 생성-> limit와 같이 사용)
  **iterate**
    ```java
    Stream.iterate('초기값', '람다식')
    ```
    - 람다식은 1개의 인자를 받는다.
    - 이전 반환값은 다음 입력값이 된다.
    ```java
    Stream.iterate(0,n->n+2) // 0, 2, 4, 6
    ```
  **generate**
    ```java
    Stream.generate('람다식')
    ```
    - 이전 값과 별개의(연속되지 않은) 값을 반환한다.
    ```java
    Stream.generate(Math::random)
    ```
